import{g as N,a as $,d as D,q as S,O as v,y as b,$ as q,u as d,F as w,C as F,i as T,b as k,T as g,c as P,k as h,e as H,f as M,h as U,o as C}from"./stylex-DrczieMk.js";const R=()=>{const t=["cart-drawer","cart-drawer-component dialog","dialog.cart-drawer__dialog","m-cart-drawer"];for(const e of t){const r=document.querySelector(e);if(r)return r}return null},z=()=>{var t;return(t=document.querySelector(".order-value-booster-side-cart"))==null?void 0:t.parentElement},G=()=>{const t=document.querySelectorAll("cart-notification .cart-notification__links");return t[t.length-1]},I=()=>{const t=document.querySelectorAll(".side-cart");return t[t.length-1]},Q=()=>document.querySelector('form[action$="/cart"]'),V=()=>document.querySelector(".essential-upsell-side-cart"),Y=()=>{const t=document.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom");return t?t.parentElement:null},j=()=>V()||Y()||z()||G()||I()||Q(),E=()=>R()||j(),x=({defaultPlacementSelectors:t})=>{for(const e of t){const r=document.querySelector(e);if(r)return r}return null},J=({isFallbackActive:t,renderAboveCartButton:e=!1,funnelId:r})=>{if(!t)return null;const l=N(),o=$();if(e&&o){const n=r?`.essential-upsell-addon-container[data-essential-upsell-id="${r}"]`:".essential-upsell-addon-container";let c=document.querySelector(n);if(!c){c=document.createElement("div"),c.className="essential-upsell-addon-container",r&&c.setAttribute("data-essential-upsell-id",r);const s=o.parentElement,i=s==null?void 0:s.parentElement;i&&s?i.insertBefore(c,s):s==null||s.insertBefore(c,o)}return c}return l||document.querySelector("product-info")},K=({defaultPlacementSelectors:t,isFallbackActive:e,renderAboveCartButton:r=!1,funnelId:l})=>x({defaultPlacementSelectors:t})||J({isFallbackActive:e,renderAboveCartButton:r,funnelId:l}),W=({setPortalContainer:t,defaultPlacementSelectors:e,isFallbackActive:r,renderAboveCartButton:l=!1,funnelId:o})=>{const n=K({defaultPlacementSelectors:e,isFallbackActive:r,renderAboveCartButton:l,funnelId:o});return n?(t(n),()=>{t(null)}):null},_=({selectors:t})=>t.map(e=>Array.from(document.querySelectorAll(e))).flat(),A=({appBlockSelectors:t,manualBlockSelectors:e,defaultPlacementSelectors:r,isFallbackActive:l,funnel:o})=>{const[n,c]=D(null),s=S(()=>{var f;const a=E(),u=_({selectors:t});if(Array.from(u).some(p=>a?!a.contains(p):!0))return null;const y=(o==null?void 0:o.content.offerType)===v.PRODUCT_ADDON;return W({setPortalContainer:c,defaultPlacementSelectors:r,isFallbackActive:l,renderAboveCartButton:y,funnelId:(f=o==null?void 0:o.id)==null?void 0:f.toString()})},[t,r,l,o==null?void 0:o.content.offerType,o==null?void 0:o.id]),i=S(()=>{const a=E(),m=_({selectors:e}).find(y=>a?!a.contains(y):!1);if(m){c(m);return}return s()},[s,e]);return b(i,[i]),{productPagePortalContainer:n}},X=({funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:l,shopMoneyFormat:o})=>{const{productPagePortalContainer:n}=A({appBlockSelectors:["essential-upsell-cross-sell-app-block"],manualBlockSelectors:[".essential-upsell-cross-sell-block",".essential-upsell-block"],defaultPlacementSelectors:[".essential-upsell-cross-sell-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!e});return n?q(d(w,{funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:l,shopMoneyFormat:o}),n):null},Z=()=>{const t=["cart-items.page-width","cart-items .page-width","cart-items","cart-items-component .cart-page .cart-items__wrapper"];for(const e of t){const r=document.querySelector(e);if(r)return r}return null},O=({funnel:t,element:e,setPortalContainer:r})=>{const l=document.createElement("div");return t.placement.cartPagePositionType===F.TOP_OF_THE_CART?e.prepend(l):t.placement.cartPagePositionType===F.BOTTOM_OF_THE_CART&&e.append(l),r(l),()=>{r(null),l.remove()}},B=({funnel:t,element:e,setPortalContainer:r})=>{if(t.placement.cartPagePositionType===F.TOP_OF_THE_CART){const l=e.querySelector(".essential-upsell-side-cart-top");if(l)return r(l),()=>{r(null)};if(e.querySelector("cart-drawer-items.is-empty")||e.classList.contains("cart-drawer--empty")){r(null);return}const o=e.querySelector("cart-drawer-items:not(.is-empty)")||e.querySelector(".drawer__scrollable");if(o){const s=document.createElement("div");return o.append(s),r(s),()=>{r(null),s.remove()}}const n=e.querySelector("scroll-hint.cart-drawer__items");if(n){const s=document.createElement("div");return n.append(s),r(s),()=>{r(null),s.remove()}}const c=document.createElement("div");return e.prepend(c),r(c),()=>{r(null),c.remove()}}else if(t.placement.cartPagePositionType===F.BOTTOM_OF_THE_CART){const l=e.querySelector(".essential-upsell-side-cart-bottom");if(l)return r(l),()=>{r(null)};const o=e.querySelector(".drawer__footer");if(o){const s=document.createElement("div");return o.prepend(s),r(s),()=>{r(null),s.remove()}}const n=e.querySelector(".cart__original-total-container");if(n){const s=document.createElement("div");return n.append(s),r(s),()=>{r(null),s.remove()}}const c=document.createElement("div");return e.append(c),r(c),()=>{r(null),c.remove()}}},ee=()=>{if(!T())return null;const t=document.querySelectorAll('form[action$="/cart"]'),e=t[t.length-1];return e?e.parentNode:null},L=({funnel:t,setPortalContainer:e})=>{const r=Z();if(r)return O({funnel:t,element:r,setPortalContainer:e});const l=R();if(l)return B({funnel:t,element:l,setPortalContainer:e});const o=ee();if(o)return O({funnel:t,element:o,setPortalContainer:e});const n=j();if(n)return B({funnel:t,element:n,setPortalContainer:e})},te=({funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:l,shopMoneyFormat:o})=>{const[n,c]=D(null),s=S(()=>{const a=T()?document:E();return a&&a.querySelector("essential-upsell-cross-sell-app-block")?null:L({funnel:t,setPortalContainer:c})},[t]),i=S(()=>{const a=T()?document:E(),u=a&&(a.querySelector(".essential-upsell-cross-sell-block")||a.querySelector(".essential-upsell-block"));if(u){c(u);return}return s()},[s]);return b(i,[i]),b(()=>{if(!n)return;const a=new MutationObserver(u=>{u.some(y=>Array.from(y.removedNodes).some(f=>f.contains(n)))&&(c(null),n.remove(),i())});return a.observe(document.body,{childList:!0,subtree:!0}),()=>{a.disconnect()}},[i,n]),b(()=>{if(n)return;const a=E();if(!a)return;const u=new MutationObserver(m=>{m.some(f=>Array.from(f.addedNodes).some(p=>!(p instanceof Element)||!p.querySelector?!1:!!p.querySelector("cart-drawer-items:not(.is-empty)")||!!p.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom")))&&s()});return u.observe(a,{childList:!0,subtree:!0}),()=>{u.disconnect()}},[s,n]),n?q(d(w,{funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:l,shopMoneyFormat:o}),n):null},re=({funnels:t,productPageProduct:e,productPageCollectionIds:r,cartItems:l,firstShopProductId:o,shopMoneyFormat:n})=>{const c=k({funnels:t,productPageProduct:e,productPageCollectionIds:r}),s=g(()=>P({funnels:t,cartItems:l}),[t,l]);return d(h,{children:[c&&d(X,{funnel:c,productPageProduct:e,cartItems:l,firstShopProductId:o,shopMoneyFormat:n}),s&&d(te,{funnel:s,productPageProduct:e,cartItems:l,firstShopProductId:o,shopMoneyFormat:n})]})},ne=({funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:l,shopMoneyFormat:o,productPageCollectionIds:n})=>{const{productPagePortalContainer:c}=A({appBlockSelectors:["essential-upsell-frequently-bought-together-app-block"],manualBlockSelectors:[".essential-upsell-frequently-bought-together-block"],defaultPlacementSelectors:[".essential-upsell-frequently-bought-together-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!e});return c?q(d(w,{funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:l,shopMoneyFormat:o,productPageCollectionIds:n}),c):null},oe=({funnels:t,productPageProduct:e,productPageCollectionIds:r,cartItems:l,firstShopProductId:o,shopMoneyFormat:n})=>{const c=k({funnels:t,productPageProduct:e,productPageCollectionIds:r});return c?d(ne,{funnel:c,productPageProduct:e,cartItems:l,firstShopProductId:o,shopMoneyFormat:n,productPageCollectionIds:r}):null},se=({funnels:t,cartItems:e})=>g(()=>P({funnels:t,cartItems:e}),[t,e]),le=({funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:l,shopMoneyFormat:o,productPageCollectionIds:n})=>{const{productPagePortalContainer:c}=A({appBlockSelectors:["essential-upsell-product-addon-app-block"],manualBlockSelectors:[".essential-upsell-product-addon-block"],defaultPlacementSelectors:[".essential-upsell-product-addon-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!e,funnel:t});return c?q(d(w,{funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:l,shopMoneyFormat:o,productPageCollectionIds:n}),c):null},ce=({funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:l,shopMoneyFormat:o})=>{const[n,c]=D(null),s=S(()=>{const a=T()?document:E();return a&&a.querySelector("essential-upsell-product-addon-app-block")?null:L({funnel:t,setPortalContainer:c})},[t]),i=S(()=>{const a=T()?document:E(),u=a&&(a.querySelector(".essential-upsell-product-addon-block")||a.querySelector(".essential-upsell-block"));if(u){c(u);return}return s()},[s]);return b(i,[i]),b(()=>{if(!n)return;const a=new MutationObserver(u=>{u.some(y=>Array.from(y.removedNodes).some(f=>f.contains(n)))&&(c(null),n.remove(),i())});return a.observe(document.body,{childList:!0,subtree:!0}),()=>{a.disconnect()}},[i,n]),b(()=>{if(n)return;const a=E();if(!a)return;const u=new MutationObserver(m=>{m.some(f=>Array.from(f.addedNodes).some(p=>!(p instanceof Element)||!p.querySelector?!1:!!p.querySelector("cart-drawer-items:not(.is-empty)")||!!p.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom")))&&s()});return u.observe(a,{childList:!0,subtree:!0}),()=>{u.disconnect()}},[s,n]),n?q(d(w,{funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:l,shopMoneyFormat:o}),n):null},ae=({funnels:t,productPageProduct:e,productPageCollectionIds:r,cartItems:l,firstShopProductId:o,shopMoneyFormat:n})=>{const c=k({funnels:t,productPageProduct:e,productPageCollectionIds:r}),s=se({funnels:t,cartItems:l});return d(h,{children:[c&&d(le,{funnel:c,productPageProduct:e,cartItems:l,firstShopProductId:o,shopMoneyFormat:n,productPageCollectionIds:r}),s&&d(ce,{funnel:s,productPageProduct:e,cartItems:l,firstShopProductId:o,shopMoneyFormat:n})]})},ue=t=>{const{funnels:e,productPageCollectionIds:r,cartItems:l,firstShopProductId:o,productPageProduct:n,shopMoneyFormat:c}=M({liquidProps:t}),{cartItems:s}=U({liquidCartItems:l}),i=g(()=>e.filter(m=>C({funnel:m})===v.FREQUENTLY_BOUGHT_TOGETHER),[e]),a=g(()=>e.filter(m=>C({funnel:m})===v.CROSS_SELL),[e]),u=g(()=>e.filter(m=>C({funnel:m})===v.PRODUCT_ADDON),[e]);return d(h,{children:[d(oe,{funnels:i,productPageProduct:n,productPageCollectionIds:r,cartItems:s,firstShopProductId:o,shopMoneyFormat:c}),d(ae,{funnels:u,productPageProduct:n,productPageCollectionIds:r,cartItems:s,firstShopProductId:o,shopMoneyFormat:c}),d(re,{funnels:a,productPageProduct:n,productPageCollectionIds:r,cartItems:s,firstShopProductId:o,shopMoneyFormat:c})]})};H(ue,"essential-upsell-app-embed",["upsellAppData","upsellAppDiscountsData","productPageProduct","productPageCollectionIds","cartItems","firstShopProductId","shopMoneyFormat"]);
